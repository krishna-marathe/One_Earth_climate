<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Insights - ClimateSphere</title>
    
    <!-- Shared CSS -->
    <link rel="stylesheet" href="../shared/common.css">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .main-content {
            padding: var(--spacing-xl);
            min-height: calc(100vh - 80px);
        }
        
        .insights-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }
        
        .insights-header h1 {
            font-size: var(--font-size-3xl);
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
        }
        
        .insight-card {
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .insight-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        .insight-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }
        
        .insight-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .insight-icon.temperature {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }
        
        .insight-icon.rainfall {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }
        
        .insight-icon.co2 {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
        }
        
        .insight-icon.risk {
            background: linear-gradient(135deg, #ff7675, #d63031);
        }
        
        .insight-icon.ai {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
        }
        
        .insight-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }
        
        .insight-content {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--spacing-md);
        }
        
        .insight-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }
        
        .metric {
            text-align: center;
            padding: var(--spacing-sm);
            background: var(--background);
            border-radius: var(--radius-md);
        }
        
        .metric-value {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .metric-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        
        .insight-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            background: var(--surface);
            color: var(--text-primary);
            text-decoration: none;
            font-size: var(--font-size-sm);
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .ai-chat-panel {
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            margin-bottom: var(--spacing-xl);
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border);
        }
        
        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--background);
            border-radius: var(--radius-md);
        }
        
        .chat-message {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            max-width: 80%;
        }
        
        .chat-message.user {
            background: var(--primary-color);
            color: white;
            margin-left: auto;
        }
        
        .chat-message.ai {
            background: var(--surface);
            border: 1px solid var(--border);
        }
        
        .chat-input-container {
            display: flex;
            gap: var(--spacing-sm);
        }
        
        .chat-input {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }
        
        .suggestion-btn {
            padding: var(--spacing-sm);
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all 0.3s ease;
        }
        
        .suggestion-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .loading-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
            margin-right: var(--spacing-sm);
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }
            
            .insight-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="/landing/index.html" class="navbar-brand">
                <i class="fas fa-globe-americas"></i>
                ClimateSphere
            </a>
            <ul class="navbar-nav">
                <li><a href="/landing/index.html" class="nav-link">Home</a></li>
                <li><a href="/auth/login.html" class="nav-link">Login</a></li>
                <li><a href="/dashboard/dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="/dashboard/predictions.html" class="nav-link">Predictions</a></li>
                <li><a href="/dashboard/insights.html" class="nav-link active">Insights</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Header -->
            <div class="insights-header">
                <h1><i class="fas fa-brain"></i> Climate Insights & AI Analysis</h1>
                <p>AI-powered insights and recommendations based on climate data patterns</p>
            </div>

            <!-- AI Chat Panel -->
            <div class="ai-chat-panel">
                <div class="chat-header">
                    <div class="insight-icon ai">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3>Climate AI Assistant</h3>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message ai">
                        Hello! I'm your Climate AI Assistant. I can help you understand climate patterns, analyze data trends, and provide insights about environmental changes. What would you like to know?
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Ask me about climate patterns, trends, or predictions...">
                    <button class="btn btn-primary" id="sendMessage">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <div class="suggestions-grid" id="suggestions">
                    <!-- Suggestions will be populated by JavaScript -->
                </div>
            </div>

            <!-- Insights Grid -->
            <div class="insights-grid" id="insightsGrid">
                <!-- Insights will be populated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- Shared JavaScript -->
    <script src="../shared/api.js"></script>
    <script src="../shared/utils.js"></script>
    <script src="../shared/ai_chat.js"></script>

    <script>
        // Climate Insights functionality
        class ClimateInsights {
            constructor() {
                this.insights = [];
                this.chatHistory = [];
                this.initializeEventListeners();
                this.loadInsights();
                this.initializeAIChat();
            }

            initializeEventListeners() {
                // Chat functionality
                document.getElementById('sendMessage').addEventListener('click', () => {
                    this.sendChatMessage();
                });

                document.getElementById('chatInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendChatMessage();
                    }
                });

                // Suggestion clicks
                document.getElementById('suggestions').addEventListener('click', (e) => {
                    if (e.target.classList.contains('suggestion-btn')) {
                        const suggestion = e.target.textContent;
                        document.getElementById('chatInput').value = suggestion;
                        this.sendChatMessage();
                    }
                });
            }

            async loadInsights() {
                try {
                    // TODO: Replace with actual API call
                    const response = await window.ClimateSphereAPI.getInsights();
                    
                    if (response.demo) {
                        // Use demo insights for development
                        this.insights = this.generateDemoInsights();
                    } else {
                        this.insights = response.data;
                    }
                    
                    this.displayInsights();
                    
                } catch (error) {
                    console.error('Failed to load insights:', error);
                    ClimateSphereUtils.showNotification('Failed to load insights', 'error');
                    
                    // Use demo insights as fallback
                    this.insights = this.generateDemoInsights();
                    this.displayInsights();
                }
            }

            generateDemoInsights() {
                return [
                    {
                        id: 'temp-trend',
                        type: 'temperature',
                        title: 'Rising Temperature Trend',
                        content: 'Global temperatures have increased by 1.2°C over the past decade, with accelerating warming in polar regions. This trend indicates significant climate change impacts.',
                        metrics: [
                            { label: 'Increase', value: '+1.2°C' },
                            { label: 'Rate', value: '0.12°C/yr' },
                            { label: 'Confidence', value: '95%' }
                        ],
                        actions: ['View Details', 'Generate Report', 'Set Alert']
                    },
                    {
                        id: 'rainfall-pattern',
                        type: 'rainfall',
                        title: 'Changing Precipitation Patterns',
                        content: 'Rainfall patterns show increased variability with more extreme events. Some regions experience severe droughts while others face flooding.',
                        metrics: [
                            { label: 'Variability', value: '+23%' },
                            { label: 'Extremes', value: '↑47%' },
                            { label: 'Regions', value: '156' }
                        ],
                        actions: ['Analyze Regions', 'Flood Risk', 'Drought Alert']
                    },
                    {
                        id: 'co2-levels',
                        type: 'co2',
                        title: 'CO₂ Concentration Alert',
                        content: 'Atmospheric CO₂ levels have reached 421 ppm, the highest in human history. Immediate action is needed to reduce emissions.',
                        metrics: [
                            { label: 'Current', value: '421 ppm' },
                            { label: 'Annual Rise', value: '+2.4 ppm' },
                            { label: 'Target', value: '350 ppm' }
                        ],
                        actions: ['Emission Trends', 'Mitigation Plans', 'Policy Impact']
                    },
                    {
                        id: 'climate-risk',
                        type: 'risk',
                        title: 'Climate Risk Assessment',
                        content: 'Current climate models predict increased risk of extreme weather events, sea level rise, and ecosystem disruption in the next decade.',
                        metrics: [
                            { label: 'Risk Level', value: 'High' },
                            { label: 'Probability', value: '78%' },
                            { label: 'Impact', value: 'Severe' }
                        ],
                        actions: ['Risk Map', 'Adaptation', 'Early Warning']
                    },
                    {
                        id: 'ai-prediction',
                        type: 'ai',
                        title: 'AI Model Predictions',
                        content: 'Machine learning models predict a 2.5°C temperature increase by 2050 under current emission scenarios. Urgent climate action is required.',
                        metrics: [
                            { label: 'Prediction', value: '+2.5°C' },
                            { label: 'Timeline', value: '2050' },
                            { label: 'Accuracy', value: '89%' }
                        ],
                        actions: ['Model Details', 'Scenarios', 'Mitigation']
                    },
                    {
                        id: 'ecosystem-impact',
                        type: 'risk',
                        title: 'Ecosystem Vulnerability',
                        content: 'Climate change is affecting biodiversity with 23% of species at risk of extinction. Coral reefs and polar ecosystems are most vulnerable.',
                        metrics: [
                            { label: 'Species Risk', value: '23%' },
                            { label: 'Coral Loss', value: '50%' },
                            { label: 'Ice Loss', value: '13%/decade' }
                        ],
                        actions: ['Species Map', 'Conservation', 'Monitoring']
                    }
                ];
            }

            displayInsights() {
                const insightsGrid = document.getElementById('insightsGrid');
                
                insightsGrid.innerHTML = this.insights.map(insight => `
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon ${insight.type}">
                                <i class="fas fa-${this.getInsightIcon(insight.type)}"></i>
                            </div>
                            <h3 class="insight-title">${insight.title}</h3>
                        </div>
                        
                        <div class="insight-content">
                            ${insight.content}
                        </div>
                        
                        <div class="insight-metrics">
                            ${insight.metrics.map(metric => `
                                <div class="metric">
                                    <div class="metric-value">${metric.value}</div>
                                    <div class="metric-label">${metric.label}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="insight-actions">
                            ${insight.actions.map(action => `
                                <a href="#" class="action-btn" onclick="handleInsightAction('${insight.id}', '${action}')">
                                    ${action}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            getInsightIcon(type) {
                const icons = {
                    temperature: 'thermometer-half',
                    rainfall: 'cloud-rain',
                    co2: 'smog',
                    risk: 'exclamation-triangle',
                    ai: 'robot'
                };
                return icons[type] || 'info-circle';
            }

            async initializeAIChat() {
                // Initialize AI chat system
                await window.ClimateSphereAIChat.initialize();
                
                // Display suggested questions
                this.displaySuggestions();
            }

            displaySuggestions() {
                const suggestions = window.ClimateSphereAIChat.getSuggestedQuestions();
                const suggestionsContainer = document.getElementById('suggestions');
                
                suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                    <button class="suggestion-btn">${suggestion}</button>
                `).join('');
            }

            async sendChatMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (!message) return;
                
                // Clear input
                input.value = '';
                
                // Add user message to chat
                this.addChatMessage(message, 'user');
                
                try {
                    // Get AI response
                    const response = await window.ClimateSphereAIChat.sendMessage(message, {
                        insights: this.insights,
                        page: 'insights'
                    });
                    
                    // Add AI response to chat
                    this.addChatMessage(response, 'ai');
                    
                } catch (error) {
                    console.error('Chat error:', error);
                    this.addChatMessage('Sorry, I encountered an error. Please try again.', 'ai');
                }
            }

            addChatMessage(message, sender) {
                const chatMessages = document.getElementById('chatMessages');
                
                const messageElement = document.createElement('div');
                messageElement.className = `chat-message ${sender}`;
                messageElement.textContent = message;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // Handle insight action clicks
        function handleInsightAction(insightId, action) {
            console.log(`Action: ${action} for insight: ${insightId}`);
            
            // TODO: Implement specific actions
            switch (action) {
                case 'View Details':
                    ClimateSphereUtils.showNotification(`Viewing details for ${insightId}`, 'info');
                    break;
                case 'Generate Report':
                    ClimateSphereUtils.showNotification('Generating report...', 'info');
                    break;
                case 'Set Alert':
                    ClimateSphereUtils.showNotification('Alert configured', 'success');
                    break;
                default:
                    ClimateSphereUtils.showNotification(`${action} feature coming soon`, 'info');
            }
        }

        // Initialize insights when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ClimateInsights();
        });
    </script>
</body>
</html>